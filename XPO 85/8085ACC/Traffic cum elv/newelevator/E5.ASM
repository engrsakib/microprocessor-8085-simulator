
CPU "8085.TBL"
        HOF "INT8"
        CR55:EQU 0BH
        PORTB:EQU 09H
        PORTC:EQU 0AH
	PORTA:EQU 08H
        OUTMSG:EQU 03D8H
        CRONLY: EQU 0497H
        RCVNO:EQU 0476H
        CRLF:EQU 048AH
        DELAY:EQU 0615H
        TEST:EQU 01F1H
	CMDMOD:EQU 000CH
        NMOUT:EQU 036CH
ORG 7000H
MVI A,80H
OUT CR55

INIT: ANI 00H
STA 2151H ;new data
STA 2152H ;old data  data for deciding direction of lift
STA 2153H ;data for intermediate addresses
DISPFINPOS:CALL CRONLY
FINALPOS:LDA 2152H;To get data from look up table
LXIH,DAT_PTA
ADD L
MOV L,A
MOV A,M
OUT PORTA
LDA 2152H
LXIH,DAT_PTB
ADD L
MOV L,A
MOV A,M
OUT PORTB
LXI H,MSG1
CALL CRLF
CALL OUTMSG
LDA 2152H
MOV E,A
MVI B,02H
CALL NMOUT

KEYPRESS:MVI A,89H
OUT CR55
IN PORTC
ORI 63H
MOV B,A
MVI A,80H
OUT CR55
MVI A,00H
OUT PORTC
MOV A,B
CPI 0E3H
JZ DANGER
MOV A,B
CPI 63H
JZ FINALPOS

SEC_FLR:CPI 67H
JNZ FRST_FLR
MVI A,02H
STA 2151H
JMP  DIRECTION

FRST_FLR: MOV A,B
CPI 6BH
JNZ GND_FLR
MVI A,01H
STA 2151H
JMP  DIRECTION

GND_FLR:MOV A,B
CPI 73H
JNZ WRONG_REQ
MVI A,00H
STA 2151H
JMP  DIRECTION

WRONG_REQ:JMP INIT

DIRECTION:LDA 2152H
MOV D,A
LDA 2151H
SUB D
JZ SWAP
JC DOWN
DCR A
STA 2153H
;up direction leds should glow.

STRT_UP_DIR:MVI A,01H ;FLAG FOR DELAY=01
STA 2105H
LXI H,MSG2
CALL CRLF
CALL OUTMSG
CALL CRONLY
CALL DLY

SWAP:LDA 2151H
STA 2152H
JMP FINALPOS

DOWN:CMC
LDA 2152H
MOV B,A
LDA 2151H
MOV C,A
MOV C,B
MOV B,A
MOV A,C
SUB B
DCR A
STA 2153H

ST_DN_DIR:MVI A,00H
STA 2105H
LXI H,MSG3
CALL CRLF
CALL OUTMSG
CALL DLY
JMP SWAP

DLY:MVI C,02H

ROUT:LDA 2105H
CPI 01H
JNZ GL_DN_LED
LXI H,DAT_UP
JMP START_DIR_FG

GL_DN_LED:LXI H,DAT_DN

START_DIR_FG:MOV A,M
OUT PORTA
INX H
MOV A,M
OUT PORTB
DCX H
LXI D,0FFFH
CALL DELAY
MVI A,00H
OUT PORTA
OUT PORTB
LXI D,0FFFH
CALL DELAY
DCR C
JNZ ROUT
LDA 2153H
CPI 00H
JNZ INTR_FLR
JMP OUT_OF_DIR

INTR_FLR:LXIH,DAT_PTA
INX H
MOV A,M
OUT PORTA
LXIH,DAT_PTB
INX H
MOV A,M
OUT PORTB
LXI D,0FFFFH
CALL DELAY
LXI H,MSG6
CALL CRLF
CALL OUTMSG
LDA 2153H
MOV E,A
MVI B,02H
CALL NMOUT
MVI A,00H
STA 2153H
JMP DLY

OUT_OF_DIR:RET

DANGER:MVI A,89H
OUT CR55
LXI H,MSG4
CALL CRLF
CALL OUTMSG
CALL CRONLY
DNGR_LOOP:IN PORTC
ORI 07FH
CPI 0FFH
JNZ SAFE
MVI A,00H
OUT PORTB
OUT PORTA
LXID,0FFFH
CALL DELAY
MVI A,0FFH
OUT PORTA
OUT PORTB
LXID,0FFFH
CALL DELAY
JMP DNGR_LOOP

SAFE:LXI H,MSG5
CALL CRLF
CALL OUTMSG
CALL CRONLY
MVI C,02H

SAF1:MVI A,00H
OUT PORTA
OUT PORTB
LXID,0FFFFH
CALL DELAY
DCR C
JNZ SAF1
JMP DISPFINPOS

DAT_PTA:DFB 00H
        DFB 00H
        DFB 02H
        DFB 03H
DAT_PTB:DFB 40H
        DFB 04H
        DFB 00H
        DFB 03H
DAT_UP:DFB 01H
        DFB 22H
        DFB 03H
DAT_DN:DFB 04H
        DFB 88H
        DFB 03H
MSG1:DFB 50H
     DFB 4FH
     DFB 53H
     DFB 49H
     DFB 54H
     DFB 49H
     DFB 4FH
     DFB 4EH
     DFB 20H
     DFB 20H
     DFB 03H

MSG2:DFB 47H
DFB 4FH
DFB 49H
DFB 4EH
DFB 47H
DFB 20H
DFB 20H
DFB 55H
DFB 50H
DFB 03H
MSG3:DFB 47H
DFB 4FH
DFB 49H
DFB 4EH
DFB 47H
DFB 20H
DFB 20H
DFB 44H
DFB 4EH
DFB 03H
MSG4:DFB 44H
DFB 41H
DFB 4EH
DFB 47H
DFB 45H
DFB 52H
DFB 03H
MSG5:DFB 53H
DFB 41H
DFB 46H
DFB 45H
DFB 03H
 MSG6:DFB 50H
     DFB 4FH
     DFB 53H
     DFB 49H
     DFB 54H
     DFB 49H
     DFB 4FH
     DFB 4EH
     DFB 20H
     DFB 20H
     DFB 03H


