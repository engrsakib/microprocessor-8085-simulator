
 IBM Personal Computer MACRO Assembler   Version 2.00  	Page	1-1
-- TEMP.CONTROLLER (ADC+RELAY CARD)	 	 	 	05-05-99    


 	 	 	 	PAGE,85
 	 	 	 	TITLE-- TEMP.CONTROLLER (ADC+RELAY CARD)
 	 	 	 	
 	 	 	 	;********************************************
 	 	 	 	;TEMP. CONTROLLER USING RELAY CARD AND
 	 	 	 	;TEMP. SENSORS INTERFACE MODULES.
 	 	 	 	;********************************************
 	 	 	 	
 	 	 	 	;KEEP "SET POINT" VALUE IN MEMORY
 	 	 	 	;LOCATION ADDRESS 0000:1000H.
 	 	 	 	;KEEP "LIMIT BAND" VALUE IN MEMORY
 	 	 	 	;LOCATION ADDRESS 0000:1001H.
 	 	 	 	;USING "SUBSTITUTE" COMMAND ENTER
 	 	 	 	;VALUES IN HEXADECIMAL FORM ONLY.
 	 	 	 	
 0000	 	 	 	ADC SEGMENT
 	 	 	 	ASSUME CS:ADC, DS:ADC ,ES:ADC
 0100	 	 	 	ORG 100H       ;COM FORMAT IS RECOMMENDED.
 	 	 	 	
 0100  EB 07 90	 	 	STRT:JMP SKIP_DATA ;SKIP LOOK UP/DATA BASES
 	 	 	 	
 	 	 	 	;ON KIT YOU NEED TO DO INIT FOR SP
 	 	 	 	;[TO SEPARATE STACK OF YOUR PROGRAME FROM
 	 	 	 	;MONITORS],DS AS SHOWN BELOW.
 	 	 	 	;SS,ES ARE SET TO 0000 AT POWER ON BY MONITOR.
 	 	 	 	;YOU CAN OFCOURSE CHANGE IT
 	 	 	 	;BY ADDING A FEW MORE MOVE`S.
 	 	 	 	;BUT WHILE WORKING ON PC YOU CAN`T
 	 	 	 	;TOUCH SEGMENT REGISTERS SINCE THEY ARE
 	 	 	 	;SET BY DOS LOADER,SO MANAGE THESE
 	 	 	 	;INSTRUCTIONS AS SHOWN IN COMMENT FIELD.
 	 	 	 	
 0103  48 20 44 45 47 03	DEG: DB "H DEG",03H  ;TEXT DEGREE.
 	 	 	 	
 0109	 	 	 	SKIP_DATA:
 0109  B8 11FF	 	 	MOV AX,11FFH    ;INIT OF SP FOR KIT
 010C  8B E0	 	 	MOV SP,AX       ;MOV AX,AX   ON PC
 010E  B8 0000	 	 	MOV AX,0000H    ;SCPD SEG.
 0111  90	 	 	NOP             ;FOR PC
 0112  8E C0	 	 	MOV ES,AX       ;ES SEG. INIT
 	 	 	 	
 0114  0E	 	 	PUSH CS   ;THIS IS THE BEST WAY TO LOAD DS
 0115  58	 	 	POP AX    ;WITH SEGMENT VALUE.
 0116  8E D8	 	 	MOV DS,AX
 0118  90	 	 	NOP       ;LOAD KIT INT S (A0-BF) IN PC USING
 0119  90	 	 	NOP       ;CALL LDINPC
 011A  90	 	 	NOP       ;PLACE ABOVE CALL IN PLACE OF NOP`S
 011B  CD AC	 	 	INT 0ACH  ;CLEAR DISPLAY
 	 	 	 	
 	 	 	 	;UPPER & LOWER LIMIT CALCULATION
 	 	 	 	;FROM SET POINT & CONTROL BAND.
011D  26: 8A 1E 1000	 	MOV BL,ES:[1000H] ;SET VALUE
 0122  26: 8A 0E 1001	 	MOV CL,ES:[1001H] ;LIMIT BAND

 IBM Personal Computer MACRO Assembler   Version 2.00  	Page	1-2
-- TEMP.CONTROLLER (ADC+RELAY CARD)	 	 	 	05-05-99    


 0127  02 D9	 	 	ADD BL,CL
 0129  26: 88 1E 1002	 	MOV ES:[1002H],BL ;STORE UPPER LIMIT
 012E  26: 8A 1E 1000	 	MOV BL,ES:[1000H]
 0133  26: 8A 0E 1001	 	MOV CL,ES:[1001H]
 0138  2A D9	 	 	SUB BL,CL
 013A  26: 88 1E 1003	 	MOV ES:[1003H],BL ;STORE LOWER LIMIT
 	 	 	 	
 	 	 	 	;8255 INITIALISATION & ADC.
 	 	 	 	
 013F  B0 92	 	 	MOV AL,92H  ;INIT 8255L A,B-IN.C-OUT.
 0141  BA 8807	 	 	MOV DX,8807H
 0144  EE	 	 	OUT DX,AL
 	 	 	 	
 0145  B8 8080	 	 	MOV AX,8080H ;INIT 8255U ALL O/P
 0148  BA 8006	 	 	MOV DX,8006H
 014B  EF	 	 	OUT DX,AX
 	 	 	 	
 014C	 	 	 	LOOP01:
 014C  BA 8805	 	 	MOV DX,8805H ;PORT C=1*010000 SET FOR DIFF,
 014F  B0 90	 	 	MOV AL,90H   ;SAMPLE MODE FOR S/H,
 0151  EE	 	 	OUT DX,AL    ;CH INFO IS RELEVANT IF CONNECT
 	 	 	 	             ;INSTRU OP AMP MODULE TO ADC
 0152  BA 8803	 	 	MOV DX,8803H
 0155  EC	 	 	LOOP02:IN AL,DX ;CHECK STATUS LINE
 0156  24 40	 	 	AND AL,40H      ;CONVERSION REALY BEGUN?
 0158  74 FB	 	 	JZ LOOP02
 	 	 	 	
 015A	 	 	 	LOOP03:
 015A  EC	 	 	IN AL,DX    ;NOW CONVERSION REALLY STARTS.
 015B  24 40	 	 	AND AL,40H  ;CONVERSION OVER?
 015D  75 FB	 	 	JNZ LOOP03
 	 	 	 	
 015F  BA 8805	 	 	MOV DX,8805H
 0162  EC	 	 	IN AL,DX    ;SET CS LOW AND PUT ADC
 0163  24 7F	 	 	AND AL,7FH  ;IN HOLD MODE.
 0165  EE	 	 	OUT DX,AL
 	 	 	 	
 0166  BA 8801	 	 	MOV DX,8801H
 0169  EC	 	 	IN AL,DX    ;READ LOWER BYTE
 016A  8A C8	 	 	MOV CL,AL
 	 	 	 	
 016C  BA 8803	 	 	MOV DX,8803H
 016F  EC	 	 	IN AL,DX    ;READ UPPER BYTE
 0170  24 1F	 	 	AND AL,1FH  ;SUPRESS POLARITY & DON`T CARE,
 0172  8A E8	 	 	MOV CH,AL   ;SAVE IT
 	 	 	 	
 	 	 	 	;DIGITAL DATA CONVERTED INTO TEMP. IN DEG.C
 	 	 	 	
 0174  B3 1C	 	 	MOV BL,001CH ;SCALING FACTOR
 0176  8B C1	 	 	MOV AX,CX    ;(1C PT100/A0 TERMOCOUPLE)
 0178  F6 F3	 	 	DIV BL
 017A  8B C8	 	 	MOV CX,AX
 017C  26: 88 0E 1004	 	MOV ES:[1004H],CL ;STORE TEMP. VALUE.

 IBM Personal Computer MACRO Assembler   Version 2.00  	Page	1-3
-- TEMP.CONTROLLER (ADC+RELAY CARD)	 	 	 	05-05-99    


 0181  8A D0	 	 	MOV DL,AL
 0183  CD AB	 	 	INT 0ABH     ;CALL CRET-ONLY LINE FEED
 0185  EB 01 90	 	 	JMP SKP3
 0188	 	 	 	SKP3:
 0188  B0 03	 	 	MOV AL,03H   ;NO. OF DIGITS
 018A  BA 0000	 	 	MOV DX,0000H
 018D  8A D1	 	 	MOV DL,CL    ;RT.HAND JUSTIFIED NO.
 018F  CD AE	 	 	INT 0AEH     ;CALL NMOUT
 	 	 	 	
 0191  BB 0103 R	 	MOV BX,OFFSET DEG ;DISP DEG.
 0194  CD AF	 	 	INT 0AFH
 	 	 	 	
 	 	 	 	;CONTROL OF HEATER & COOLER STARTS HERE.
 	 	 	 	
 0196	 	 	 	CNTRL:
 0196  26: A0 1004	 	MOV AL,ES:[1004H] ;LOAD ACTUAL TEMP IN AX.
 019A  26: 8A 0E 1002	 	MOV CL,ES:[1002H] ;LOAD UPPER LIMIT IN CX.
 019F  3A C1	 	 	CMP AL,CL         ;COMP ACT WITH UTP
 01A1  73 0C	 	 	JAE COOL          ;IF ABOVE THEN COOLER ON
 	 	 	 	
 01A3  26: 8A 0E 1003	 	MOV CL,ES:[1003H] ;LOAD UPPER LIMIT IN CX.
 01A8  3A C1	 	 	CMP AL,CL         ;COMPARE ACT WITH LTP
 01AA  72 0D	 	 	JNAE HEAT         ;IF BELOW THEN HEATER ON
 01AC  EB 12 90	 	 	JMP KEYIN
 	 	 	 	
 01AF	 	 	 	COOL:
 01AF  B8 F0F0	 	 	MOV AX,0F0F0H     ;MAKE COOLER ON
 01B2  BA 8000	 	 	MOV DX,8000H
 01B5  EF	 	 	OUT DX,AX
 01B6  EB 08 90	 	 	JMP KEYIN
 	 	 	 	
 01B9	 	 	 	HEAT:
 01B9  B8 0F0F	 	 	MOV AX,0F0FH      ;MAKE HEATER ON
 01BC  BA 8000	 	 	MOV DX,8000H
 01BF  EF	 	 	OUT DX,AX
 	 	 	 	
 01C0	 	 	 	KEYIN:
 01C0  B4 0B	 	 	MOV AH,0BH
 01C2  CD A1	 	 	INT 0A1H     ;CHECK FOR KEY PRESSED.
 01C4  3C 00	 	 	CMP AL,00H
 01C6  74 84	 	 	JZ LOOP01    ;KEY NOT PRESSED,HENCE CONTINUE.
 01C8  CD A3	 	 	INT 0A3H     ;CMD MODE.
 	 	 	 	
 	 	 	 	
 	 	 	 	
 01CA	 	 	 	ADC ENDS
 	 	 	 	END STRT


 IBM Personal Computer MACRO Assembler   Version 2.00  	Page	Symbols-1
-- TEMP.CONTROLLER (ADC+RELAY CARD)	 	 	 	05-05-99    


Segments and Groups:

	 	N a m e	 	 	Size	Align	Combine	Class

ADC. . . . . . . . . . . . . . .	01CA	PARA  	NONE	

Symbols:            

	 	N a m e	 	 	Type	Value	Attr         

CNTRL. . . . . . . . . . . . . .	L NEAR 	0196	ADC
COOL . . . . . . . . . . . . . .	L NEAR 	01AF	ADC
DEG. . . . . . . . . . . . . . .	L NEAR 	0103	ADC
HEAT . . . . . . . . . . . . . .	L NEAR 	01B9	ADC
KEYIN. . . . . . . . . . . . . .	L NEAR 	01C0	ADC
LOOP01 . . . . . . . . . . . . .	L NEAR 	014C	ADC
LOOP02 . . . . . . . . . . . . .	L NEAR 	0155	ADC
LOOP03 . . . . . . . . . . . . .	L NEAR 	015A	ADC
SKIP_DATA. . . . . . . . . . . .	L NEAR 	0109	ADC
SKP3 . . . . . . . . . . . . . .	L NEAR 	0188	ADC
STRT . . . . . . . . . . . . . .	L NEAR 	0100	ADC

50634 Bytes free   

Warning Severe
Errors	Errors 
0	0
