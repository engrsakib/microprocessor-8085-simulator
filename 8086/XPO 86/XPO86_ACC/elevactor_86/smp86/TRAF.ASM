PAGE,85
TITLE-- TRAFFIC

;************************************
;PROGRAM FOR TRAFFIC LIGHT CONTRLLER.
;************************************

TRAF  SEGMENT
ASSUME CS:TRAF, DS:TRAF ,ES:TRAF
ORG 100H  ;COM FORMAT IS RECOMMENDED.
STRT:  JMP SKIP_DATA

;SKIP  LOOK UP / DATA  BASES IF ANY
;ON KIT YOU  NEED TO DO INIT FOR SP
;[TO SEPARATE STACK OF YOUR PROGRAME
;FROM MONITORS ], DS AS SHOWN BELOW.
;SS,ES ARE SET TO 0000H AT POWER ON
;BY MONITOR.YOU CAN OFCOURSE CHANGE
;IT BY ADDING A FEW  MORE MOVE. BUT
;WHILE WORKING ON PC YOU CAN`T TOUCH
;SEGMENT  REGISTERS  SINCE THEY ARE
;SET BY DOS LOADER, SO MANAGE THESE
;INSTRUCTIONS AS  SHOWN IN  COMMENT.


SKIP_DATA:
MOV AX,11FFH
STRT1:
MOV SP,AX ;INIT OF SP ON KIT
MOV AX,AX ;ON PC
PUSH CS   ;THE BEST WAY TO LOAD DS
POP  DS   ;WITH SEGMENT VALUE.
NOP       ;LOAD KIT INT'S (A0-BF)
NOP       ;IN PC CALL LDINPC
NOP       ;PLACE CALL IN NOP`S

MOV AX,8080H  ;SET ALL PORTS
MOV DX,8806H  ;OF LOWER 8255 AS
OUT DX,AX     ;OUTPUT PORTS

START:
MOV AX,0FFFFH ;ALL RED SIGNALS
MOV DX,8804H  ;"ON"
OUT DX,AX
MOV AX,0BDBDH ;TURN OFF 2 RED
OUT DX,AX     ;AND 7RED
MOV AX,5050H  ;TURN "ON" 2 GREEN
MOV DX,8800H  ;AND 7 GREEN
OUT DX,AX
MOV CX,0FFFFH ;LOAD DELAY COUNT
CALL DELAY1   ;CALL DELAY 4 TIMES

MOV AX,0000H  ;TURN "OFF" 2 GREEN
OUT DX,AX     ;AND 7 GREEN
MOV AX,0909H  ;TURN "ON" 2 GREEN
MOV DX,8802H  ;AND 7 YELLOW
OUT DX,AX
CALL DELAY2

MOV AX,0000H  ;TURN "OFF" 2 YELLOW
OUT DX,AX     ;AND 7 YELLOW
MOV AX,0FFFFH ;TURN "ON" ALL
MOV DX,8804H  ;RED SIGNALS.
OUT DX,AX
CALL DELAY2

MOV AX,0DBDBH ;TURN ON 3R & 9R
OUT DX,AX
MOV AX,0A0AH  ;TURN ON 3G & 9G
MOV DX,8800H
OUT DX,AX
CALL DELAY1

MOV AX,0000H  ;TURN "OFF" 3G & 9G
OUT DX,AX
MOV AX,1212H  ;TURN ON 3Y & 9Y
MOV DX,8802H
OUT DX,AX
CALL DELAY2   ;CALL DELAY

MOV AX,0000H  ;TURN "OFF"  3Y & 9Y
OUT DX,AX
MOV AX,0FFFFH ;TURN "ON"
MOV DX,8804H  ;ALL RED SIGNAL
OUT DX,AX
CALL DELAY2   ;CALL DELAY

MOV AX,0EFEFH ;TURN "OFF" 5R & 6R
OUT DX,AX
MOV AX,0404H  ;TURN "ON" 5G & 6G
MOV DX,8800H  ;PEDESTRIAN CROSSING
OUT DX,AX
CALL DELAY2

MOV AX,0000H  ;TURN "OFF" 5G & 6G
OUT DX,AX
MOV AX,0FFFFH ;TURN "ON" 5R & 6R
MOV DX,8804H
OUT DX,AX
CALL DELAY2

MOV AX,0F6F6H ;TURN "OFF" 4R & 8R
OUT DX,AX
MOV AX,2121H  ;TURN "ON" 4G & 8G
MOV DX,8800H
OUT DX,AX
CALL DELAY1   ;CALL DELAY1

MOV AX,0000H  ;TURN "OFF" 4G & 8G
OUT DX,AX
MOV AX,2424H  ;TURN "ON" 4Y & 8Y
MOV DX,8802H
OUT DX,AX
CALL DELAY2

MOV AX,0000H  ;TURN "OFF" 4Y & 8Y
OUT DX,AX
MOV AX,0FFFFH ;TURN "ON" 4R & 8R
MOV DX,8804H
OUT DX,AX
CALL DELAY2   ;CALL DELAY

MOV AX,07D7DH ;TURN "OFF" 1R & 7R
OUT DX,AX
MOV AX,9090H  ;TURN "ON" 1G & 7G
MOV DX,8800H
OUT DX,AX
CALL DELAY1

MOV AX,0000H
OUT DX,AX
MOV AX,4848H  ;TURN "ON" 1Y & 7Y
MOV DX,8802H
OUT DX,AX
CALL DELAY2

MOV AX,0000H  ;TURN "OFF" 1Y & 7Y
OUT DX,AX
MOV AX,0FFFFH ;TURN "ON" 1R & 1Y
MOV DX,8804H
OUT DX,AX
CALL DELAY2   ;CALL DELAY

MOV AX,0EFEFH ;TURN "OFF" 5R & 6R
OUT DX,AX
MOV AX,0404H  ;TURN "ON" 5G & 6G
MOV DX,8800H
OUT DX,AX
CALL DELAY2

MOV AX,0000H
OUT DX,AX
MOV AX,0FFFFH ;TURN "ON" 5R & 6R
MOV DX,8804H
OUT DX,AX
CALL DELAY2

JMP START

DELAY2:
INT 0AAH
INT 0AAH
INT 0AAH
RET

DELAY1:
CALL DELAY2
CALL DELAY2
CALL DELAY2
CALL DELAY2
CALL DELAY2
RET
;IF YOU ARE RUNNING YOUR SOFTWARE ON
;PC INSERT HERE INCLUDE KIT_INTS.ASM

TRAF  ENDS ;INFO OF KIT_INTS.ASM
       END STRT

